# Инструкция по развертыванию проекта на Render.com

## Подготовка проекта

### Если Git не установлен

Если при выполнении `git init` вы получаете ошибку "git не является внутренней или внешней командой", вам нужно установить Git:

**Быстрый способ**: Установите [GitHub Desktop](https://desktop.github.com/) - это самый простой способ для начинающих.

**Альтернатива**: Скачайте Git с https://git-scm.com/download/win и установите его.

Подробные инструкции по установке Git см. в файле `GIT_SETUP.md`.

### После установки Git

1. **Убедитесь, что проект готов к развертыванию**
   - Все файлы закоммичены в Git
   - Проект загружен на GitHub

2. **Проверьте файлы конфигурации**
   - `package.json` содержит правильные скрипты
   - `render.yaml` настроен (опционально, можно настроить через веб-интерфейс)

## Шаги развертывания на Render.com

### 1. Создайте аккаунт
   - Перейдите на https://render.com
   - Зарегистрируйтесь через GitHub (рекомендуется)

### 2. Создайте новый Web Service
   - В панели Render нажмите **"New +"** → **"Web Service"**
   - Подключите ваш GitHub репозиторий
   - Выберите репозиторий с проектом

### 3. Настройте сервис
   - **Name**: `telegram-chat-app` (или любое другое имя)
   - **Environment**: `Node`
   - **Region**: Выберите ближайший регион (например, `Frankfurt` для Европы)
   - **Branch**: `main` (или ваша основная ветка)
   - **Root Directory**: Оставьте пустым (если проект в корне репозитория)
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: `Free` (для тестирования)

### 4. Настройте переменные окружения

**ВАЖНО!** Добавьте следующие переменные окружения:

1. **ADMIN_TELEGRAM_ID** (обязательно)
   - Значение: Ваш Telegram ID (число)
   - Как узнать свой Telegram ID:
     - Напишите боту [@userinfobot](https://t.me/userinfobot) в Telegram
     - Он покажет ваш ID (например: `123456789`)
   - Пример: `123456789`

2. **NODE_ENV** (опционально)
   - Значение: `production`

3. **PORT** (не нужно устанавливать)
   - Render автоматически устанавливает порт через переменную `PORT`

**Как добавить переменные окружения:**
   - В настройках сервиса найдите раздел **"Environment"**
   - Нажмите **"Add Environment Variable"**
   - Добавьте `ADMIN_TELEGRAM_ID` со значением вашего Telegram ID
   - Нажмите **"Save Changes"**

### 5. Развертывание
   - Нажмите **"Create Web Service"**
   - Дождитесь завершения сборки (обычно 2-5 минут)
   - Следите за логами в реальном времени
   - После успешного развертывания вы получите URL вида: `https://your-app.onrender.com`

### 6. Проверка развертывания
   - Откройте URL вашего приложения в браузере
   - Убедитесь, что приложение загружается
   - Проверьте логи в панели Render на наличие ошибок

### 7. Настройка Telegram Bot
   - Откройте [@BotFather](https://t.me/BotFather) в Telegram
   - Отправьте команду `/mybots`
   - Выберите вашего бота
   - Выберите **"Bot Settings"** → **"Menu Button"**
   - Выберите **"Configure menu button"**
   - Введите URL вашего приложения: `https://your-app.onrender.com`
   - Нажмите **"Done"**

### 8. Проверка администратора
   - Откройте приложение через Telegram
   - Зарегистрируйтесь с вашим аккаунтом (Telegram ID должен совпадать с `ADMIN_TELEGRAM_ID`)
   - В нижней навигации должна появиться кнопка **"Админ"**
   - Нажмите на неё и войдите в админ-панель

## Важные замечания

### База данных SQLite
- SQLite файл (`database.db`) будет храниться в файловой системе сервера
- При перезапуске сервера данные сохраняются
- Для продакшена рекомендуется использовать PostgreSQL (можно добавить позже)

### WebSocket
- Render автоматически поддерживает WebSocket
- Используется протокол `wss://` для безопасного подключения
- Клиент автоматически определяет правильный протокол

### Бесплатный план Render
- Сервис может "засыпать" после 15 минут неактивности
- Первый запрос после пробуждения может занять 30-60 секунд
- Для продакшена рекомендуется платный план

### Обновление кода
- После каждого push в GitHub, Render автоматически переразвернет приложение
- Или можно нажать **"Manual Deploy"** → **"Deploy latest commit"** в панели Render

## Устранение проблем

### Приложение не запускается
1. Проверьте логи в панели Render
2. Убедитесь, что все зависимости установлены (`npm install` прошел успешно)
3. Проверьте, что порт настроен правильно (используется `process.env.PORT`)

### Админ-панель не видна
1. Убедитесь, что `ADMIN_TELEGRAM_ID` установлен правильно
2. Проверьте, что ваш Telegram ID совпадает с переменной окружения
3. Перезарегистрируйтесь в приложении после установки переменной

### WebSocket не работает
1. Убедитесь, что используете HTTPS URL (`https://`)
2. Проверьте логи на наличие ошибок WebSocket
3. Убедитесь, что Render поддерживает WebSocket (бесплатный план поддерживает)

## Дополнительные настройки

### Автоматическое развертывание
- По умолчанию включено автоматическое развертывание при push в GitHub
- Можно отключить в настройках сервиса

### Мониторинг
- Render предоставляет метрики использования ресурсов
- Следите за использованием памяти и CPU на бесплатном плане

### Резервное копирование
- Рекомендуется регулярно экспортировать базу данных
- Можно добавить автоматическое резервное копирование через cron-задачи

---

## Вариант 2: Railway.app

### Шаги развертывания:

1. **Создайте аккаунт на Railway.app**
   - Перейдите на https://railway.app
   - Зарегистрируйтесь через GitHub

2. **Создайте новый проект**
   - Нажмите "New Project"
   - Выберите "Deploy from GitHub repo"
   - Выберите ваш репозиторий

3. **Настройте сервис**
   - Railway автоматически определит Node.js проект
   - Файл `railway.json` уже настроен
   - Нажмите "Deploy"

4. **Получите URL**
   - После развертывания Railway предоставит URL
   - Обновите `API_BASE_URL` в `js/utils/api.js`

---

## Вариант 3: Fly.io

### Шаги развертывания:

1. **Установите Fly CLI**
   ```bash
   # Windows (PowerShell)
   powershell -Command "iwr https://fly.io/install.ps1 -useb | iex"
   ```

2. **Создайте аккаунт**
   ```bash
   fly auth signup
   ```

3. **Создайте приложение**
   ```bash
   fly launch
   ```
   - Следуйте инструкциям
   - Выберите регион (например, `iad` для США)

4. **Разверните**
   ```bash
   fly deploy
   ```

---

## Важные замечания

### База данных SQLite
- SQLite файл будет храниться в файловой системе сервера
- При перезапуске сервера данные сохраняются
- Для продакшена рекомендуется использовать PostgreSQL (можно добавить позже)

### WebSocket
- Все перечисленные платформы поддерживают WebSocket
- Убедитесь, что используете правильный протокол (`wss://` для HTTPS)

### Обновление API URL
После развертывания обязательно обновите `API_BASE_URL` в файле:
- `js/utils/api.js` - строка с `API_BASE_URL`

### Telegram Mini App
Если вы используете Telegram Mini App:
1. Обновите URL в настройках бота в BotFather
2. Используйте HTTPS URL от хостинга

### Мониторинг
- Render и Railway предоставляют логи в реальном времени
- Следите за использованием ресурсов на бесплатном тарифе

---

## Рекомендации

**Для тестирования**: Используйте Render.com - самый простой и надежный вариант
**Для продакшена**: Рассмотрите Railway.app или платный план Render

---

## Поддержка

Если возникнут проблемы:
1. Проверьте логи в панели хостинга
2. Убедитесь, что порт настроен правильно
3. Проверьте, что все зависимости установлены
4. Убедитесь, что база данных инициализируется корректно

